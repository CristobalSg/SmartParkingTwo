generator client {
  provider = "prisma-client-js"
  output   = "../../../../../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enum para tipos especiales de estacionamiento
enum ParkingSpecialType {
  regular
  disabled
  pregnant
  electric
  visitor
}

// Enum para estados de reserva
enum ReservationStatus {
  pending
  confirmed
  active
  completed
  cancelled
  expired
}

// Tabla de administradores
model Administrator {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email        String   @unique @db.VarChar(255)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  name         String   @db.VarChar(255)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("administrators")
}

// Tabla de usuarios finales
model User {
  id                String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email             String   @unique @db.VarChar(255)
  name              String   @db.VarChar(255)
  emailVerified     Boolean  @default(false) @map("email_verified")
  verificationToken String?  @map("verification_token") @db.VarChar(255)
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  reservations Reservation[]

  @@map("users")
}

// Zonas de estacionamiento
model ParkingZone {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String   @db.VarChar(255)
  description String?  @db.Text
  capacity    Int
  createdAt   DateTime @default(now()) @map("created_at")

  parkingSpaces ParkingSpace[]

  @@map("parking_zones")
}

// Espacios individuales de estacionamiento
model ParkingSpace {
  id          String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  zoneId      String             @map("zone_id") @db.Uuid
  spaceNumber String             @map("space_number") @db.VarChar(10)
  specialType ParkingSpecialType @default(regular) @map("special_type")
  isActive    Boolean            @default(true) @map("is_active")
  createdAt   DateTime           @default(now()) @map("created_at")

  zone         ParkingZone   @relation(fields: [zoneId], references: [id], onDelete: Cascade)
  reservations Reservation[]

  @@unique([zoneId, spaceNumber])
  @@map("parking_spaces")
}

// Reservas de estacionamiento
model Reservation {
  id             String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId         String             @map("user_id") @db.Uuid
  parkingSpaceId String             @map("parking_space_id") @db.Uuid
  status         ReservationStatus  @default(pending)
  reservedFrom   DateTime           @map("reserved_from")
  reservedUntil  DateTime           @map("reserved_until")
  specialNeeds   ParkingSpecialType @default(regular) @map("special_needs")
  createdAt      DateTime           @default(now()) @map("created_at")
  updatedAt      DateTime           @updatedAt @map("updated_at")

  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  parkingSpace ParkingSpace @relation(fields: [parkingSpaceId], references: [id], onDelete: Cascade)

  @@map("reservations")
}
